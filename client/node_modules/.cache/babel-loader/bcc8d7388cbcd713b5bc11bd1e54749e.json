{"ast":null,"code":"/**\n * cssfilter\n *\n * @author 老雷<leizongmin@gmail.com>\n */\nvar _ = require('./util');\n/**\n * 解析style\n *\n * @param {String} css\n * @param {Function} onAttr 处理属性的函数\n *   参数格式： function (sourcePosition, position, name, value, source)\n * @return {String}\n */\n\n\nfunction parseStyle(css, onAttr) {\n  css = _.trimRight(css);\n  if (css[css.length - 1] !== ';') css += ';';\n  var cssLength = css.length;\n  var isParenthesisOpen = false;\n  var lastPos = 0;\n  var i = 0;\n  var retCSS = '';\n\n  function addNewAttr() {\n    // 如果没有正常的闭合圆括号，则直接忽略当前属性\n    if (!isParenthesisOpen) {\n      var source = _.trim(css.slice(lastPos, i));\n\n      var j = source.indexOf(':');\n\n      if (j !== -1) {\n        var name = _.trim(source.slice(0, j));\n\n        var value = _.trim(source.slice(j + 1)); // 必须有属性名称\n\n\n        if (name) {\n          var ret = onAttr(lastPos, retCSS.length, name, value, source);\n          if (ret) retCSS += ret + '; ';\n        }\n      }\n    }\n\n    lastPos = i + 1;\n  }\n\n  for (; i < cssLength; i++) {\n    var c = css[i];\n\n    if (c === '/' && css[i + 1] === '*') {\n      // 备注开始\n      var j = css.indexOf('*/', i + 2); // 如果没有正常的备注结束，则后面的部分全部跳过\n\n      if (j === -1) break; // 直接将当前位置调到备注结尾，并且初始化状态\n\n      i = j + 1;\n      lastPos = i + 1;\n      isParenthesisOpen = false;\n    } else if (c === '(') {\n      isParenthesisOpen = true;\n    } else if (c === ')') {\n      isParenthesisOpen = false;\n    } else if (c === ';') {\n      if (isParenthesisOpen) {// 在圆括号里面，忽略\n      } else {\n        addNewAttr();\n      }\n    } else if (c === '\\n') {\n      addNewAttr();\n    }\n  }\n\n  return _.trim(retCSS);\n}\n\nmodule.exports = parseStyle;","map":{"version":3,"sources":["C:/Users/Sallam/Desktop/projects/next-step/server/node_modules/cssfilter/lib/parser.js"],"names":["_","require","parseStyle","css","onAttr","trimRight","length","cssLength","isParenthesisOpen","lastPos","i","retCSS","addNewAttr","source","trim","slice","j","indexOf","name","value","ret","c","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AAEA,IAAIA,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAf;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,UAAT,CAAqBC,GAArB,EAA0BC,MAA1B,EAAkC;AAChCD,EAAAA,GAAG,GAAGH,CAAC,CAACK,SAAF,CAAYF,GAAZ,CAAN;AACA,MAAIA,GAAG,CAACA,GAAG,CAACG,MAAJ,GAAa,CAAd,CAAH,KAAwB,GAA5B,EAAiCH,GAAG,IAAI,GAAP;AACjC,MAAII,SAAS,GAAGJ,GAAG,CAACG,MAApB;AACA,MAAIE,iBAAiB,GAAG,KAAxB;AACA,MAAIC,OAAO,GAAG,CAAd;AACA,MAAIC,CAAC,GAAG,CAAR;AACA,MAAIC,MAAM,GAAG,EAAb;;AAEA,WAASC,UAAT,GAAuB;AACrB;AACA,QAAI,CAACJ,iBAAL,EAAwB;AACtB,UAAIK,MAAM,GAAGb,CAAC,CAACc,IAAF,CAAOX,GAAG,CAACY,KAAJ,CAAUN,OAAV,EAAmBC,CAAnB,CAAP,CAAb;;AACA,UAAIM,CAAC,GAAGH,MAAM,CAACI,OAAP,CAAe,GAAf,CAAR;;AACA,UAAID,CAAC,KAAK,CAAC,CAAX,EAAc;AACZ,YAAIE,IAAI,GAAGlB,CAAC,CAACc,IAAF,CAAOD,MAAM,CAACE,KAAP,CAAa,CAAb,EAAgBC,CAAhB,CAAP,CAAX;;AACA,YAAIG,KAAK,GAAGnB,CAAC,CAACc,IAAF,CAAOD,MAAM,CAACE,KAAP,CAAaC,CAAC,GAAG,CAAjB,CAAP,CAAZ,CAFY,CAGZ;;;AACA,YAAIE,IAAJ,EAAU;AACR,cAAIE,GAAG,GAAGhB,MAAM,CAACK,OAAD,EAAUE,MAAM,CAACL,MAAjB,EAAyBY,IAAzB,EAA+BC,KAA/B,EAAsCN,MAAtC,CAAhB;AACA,cAAIO,GAAJ,EAAST,MAAM,IAAIS,GAAG,GAAG,IAAhB;AACV;AACF;AACF;;AACDX,IAAAA,OAAO,GAAGC,CAAC,GAAG,CAAd;AACD;;AAED,SAAOA,CAAC,GAAGH,SAAX,EAAsBG,CAAC,EAAvB,EAA2B;AACzB,QAAIW,CAAC,GAAGlB,GAAG,CAACO,CAAD,CAAX;;AACA,QAAIW,CAAC,KAAK,GAAN,IAAalB,GAAG,CAACO,CAAC,GAAG,CAAL,CAAH,KAAe,GAAhC,EAAqC;AACnC;AACA,UAAIM,CAAC,GAAGb,GAAG,CAACc,OAAJ,CAAY,IAAZ,EAAkBP,CAAC,GAAG,CAAtB,CAAR,CAFmC,CAGnC;;AACA,UAAIM,CAAC,KAAK,CAAC,CAAX,EAAc,MAJqB,CAKnC;;AACAN,MAAAA,CAAC,GAAGM,CAAC,GAAG,CAAR;AACAP,MAAAA,OAAO,GAAGC,CAAC,GAAG,CAAd;AACAF,MAAAA,iBAAiB,GAAG,KAApB;AACD,KATD,MASO,IAAIa,CAAC,KAAK,GAAV,EAAe;AACpBb,MAAAA,iBAAiB,GAAG,IAApB;AACD,KAFM,MAEA,IAAIa,CAAC,KAAK,GAAV,EAAe;AACpBb,MAAAA,iBAAiB,GAAG,KAApB;AACD,KAFM,MAEA,IAAIa,CAAC,KAAK,GAAV,EAAe;AACpB,UAAIb,iBAAJ,EAAuB,CACrB;AACD,OAFD,MAEO;AACLI,QAAAA,UAAU;AACX;AACF,KANM,MAMA,IAAIS,CAAC,KAAK,IAAV,EAAgB;AACrBT,MAAAA,UAAU;AACX;AACF;;AAED,SAAOZ,CAAC,CAACc,IAAF,CAAOH,MAAP,CAAP;AACD;;AAEDW,MAAM,CAACC,OAAP,GAAiBrB,UAAjB","sourcesContent":["/**\n * cssfilter\n *\n * @author 老雷<leizongmin@gmail.com>\n */\n\nvar _ = require('./util');\n\n\n/**\n * 解析style\n *\n * @param {String} css\n * @param {Function} onAttr 处理属性的函数\n *   参数格式： function (sourcePosition, position, name, value, source)\n * @return {String}\n */\nfunction parseStyle (css, onAttr) {\n  css = _.trimRight(css);\n  if (css[css.length - 1] !== ';') css += ';';\n  var cssLength = css.length;\n  var isParenthesisOpen = false;\n  var lastPos = 0;\n  var i = 0;\n  var retCSS = '';\n\n  function addNewAttr () {\n    // 如果没有正常的闭合圆括号，则直接忽略当前属性\n    if (!isParenthesisOpen) {\n      var source = _.trim(css.slice(lastPos, i));\n      var j = source.indexOf(':');\n      if (j !== -1) {\n        var name = _.trim(source.slice(0, j));\n        var value = _.trim(source.slice(j + 1));\n        // 必须有属性名称\n        if (name) {\n          var ret = onAttr(lastPos, retCSS.length, name, value, source);\n          if (ret) retCSS += ret + '; ';\n        }\n      }\n    }\n    lastPos = i + 1;\n  }\n\n  for (; i < cssLength; i++) {\n    var c = css[i];\n    if (c === '/' && css[i + 1] === '*') {\n      // 备注开始\n      var j = css.indexOf('*/', i + 2);\n      // 如果没有正常的备注结束，则后面的部分全部跳过\n      if (j === -1) break;\n      // 直接将当前位置调到备注结尾，并且初始化状态\n      i = j + 1;\n      lastPos = i + 1;\n      isParenthesisOpen = false;\n    } else if (c === '(') {\n      isParenthesisOpen = true;\n    } else if (c === ')') {\n      isParenthesisOpen = false;\n    } else if (c === ';') {\n      if (isParenthesisOpen) {\n        // 在圆括号里面，忽略\n      } else {\n        addNewAttr();\n      }\n    } else if (c === '\\n') {\n      addNewAttr();\n    }\n  }\n\n  return _.trim(retCSS);\n}\n\nmodule.exports = parseStyle;\n"]},"metadata":{},"sourceType":"script"}