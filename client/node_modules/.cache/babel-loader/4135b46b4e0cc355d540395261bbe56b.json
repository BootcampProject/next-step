{"ast":null,"code":"/**\n * default settings\n *\n * @author Zongmin Lei<leizongmin@gmail.com>\n */\nvar FilterCSS = require(\"cssfilter\").FilterCSS;\n\nvar getDefaultCSSWhiteList = require(\"cssfilter\").getDefaultWhiteList;\n\nvar _ = require(\"./util\");\n\nfunction getDefaultWhiteList() {\n  return {\n    a: [\"target\", \"href\", \"title\"],\n    abbr: [\"title\"],\n    address: [],\n    area: [\"shape\", \"coords\", \"href\", \"alt\"],\n    article: [],\n    aside: [],\n    audio: [\"autoplay\", \"controls\", \"crossorigin\", \"loop\", \"muted\", \"preload\", \"src\"],\n    b: [],\n    bdi: [\"dir\"],\n    bdo: [\"dir\"],\n    big: [],\n    blockquote: [\"cite\"],\n    br: [],\n    caption: [],\n    center: [],\n    cite: [],\n    code: [],\n    col: [\"align\", \"valign\", \"span\", \"width\"],\n    colgroup: [\"align\", \"valign\", \"span\", \"width\"],\n    dd: [],\n    del: [\"datetime\"],\n    details: [\"open\"],\n    div: [],\n    dl: [],\n    dt: [],\n    em: [],\n    figcaption: [],\n    figure: [],\n    font: [\"color\", \"size\", \"face\"],\n    footer: [],\n    h1: [],\n    h2: [],\n    h3: [],\n    h4: [],\n    h5: [],\n    h6: [],\n    header: [],\n    hr: [],\n    i: [],\n    img: [\"src\", \"alt\", \"title\", \"width\", \"height\"],\n    ins: [\"datetime\"],\n    li: [],\n    mark: [],\n    nav: [],\n    ol: [],\n    p: [],\n    pre: [],\n    s: [],\n    section: [],\n    small: [],\n    span: [],\n    sub: [],\n    summary: [],\n    sup: [],\n    strong: [],\n    strike: [],\n    table: [\"width\", \"border\", \"align\", \"valign\"],\n    tbody: [\"align\", \"valign\"],\n    td: [\"width\", \"rowspan\", \"colspan\", \"align\", \"valign\"],\n    tfoot: [\"align\", \"valign\"],\n    th: [\"width\", \"rowspan\", \"colspan\", \"align\", \"valign\"],\n    thead: [\"align\", \"valign\"],\n    tr: [\"rowspan\", \"align\", \"valign\"],\n    tt: [],\n    u: [],\n    ul: [],\n    video: [\"autoplay\", \"controls\", \"crossorigin\", \"loop\", \"muted\", \"playsinline\", \"poster\", \"preload\", \"src\", \"height\", \"width\"]\n  };\n}\n\nvar defaultCSSFilter = new FilterCSS();\n/**\n * default onTag function\n *\n * @param {String} tag\n * @param {String} html\n * @param {Object} options\n * @return {String}\n */\n\nfunction onTag(tag, html, options) {// do nothing\n}\n/**\n * default onIgnoreTag function\n *\n * @param {String} tag\n * @param {String} html\n * @param {Object} options\n * @return {String}\n */\n\n\nfunction onIgnoreTag(tag, html, options) {// do nothing\n}\n/**\n * default onTagAttr function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @return {String}\n */\n\n\nfunction onTagAttr(tag, name, value) {// do nothing\n}\n/**\n * default onIgnoreTagAttr function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @return {String}\n */\n\n\nfunction onIgnoreTagAttr(tag, name, value) {// do nothing\n}\n/**\n * default escapeHtml function\n *\n * @param {String} html\n */\n\n\nfunction escapeHtml(html) {\n  return html.replace(REGEXP_LT, \"&lt;\").replace(REGEXP_GT, \"&gt;\");\n}\n/**\n * default safeAttrValue function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @param {Object} cssFilter\n * @return {String}\n */\n\n\nfunction safeAttrValue(tag, name, value, cssFilter) {\n  // unescape attribute value firstly\n  value = friendlyAttrValue(value);\n\n  if (name === \"href\" || name === \"src\") {\n    // filter `href` and `src` attribute\n    // only allow the value that starts with `http://` | `https://` | `mailto:` | `/` | `#`\n    value = _.trim(value);\n    if (value === \"#\") return \"#\";\n\n    if (!(value.substr(0, 7) === \"http://\" || value.substr(0, 8) === \"https://\" || value.substr(0, 7) === \"mailto:\" || value.substr(0, 4) === \"tel:\" || value.substr(0, 11) === \"data:image/\" || value.substr(0, 6) === \"ftp://\" || value.substr(0, 2) === \"./\" || value.substr(0, 3) === \"../\" || value[0] === \"#\" || value[0] === \"/\")) {\n      return \"\";\n    }\n  } else if (name === \"background\") {\n    // filter `background` attribute (maybe no use)\n    // `javascript:`\n    REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;\n\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {\n      return \"\";\n    }\n  } else if (name === \"style\") {\n    // `expression()`\n    REGEXP_DEFAULT_ON_TAG_ATTR_7.lastIndex = 0;\n\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_7.test(value)) {\n      return \"\";\n    } // `url()`\n\n\n    REGEXP_DEFAULT_ON_TAG_ATTR_8.lastIndex = 0;\n\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_8.test(value)) {\n      REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;\n\n      if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {\n        return \"\";\n      }\n    }\n\n    if (cssFilter !== false) {\n      cssFilter = cssFilter || defaultCSSFilter;\n      value = cssFilter.process(value);\n    }\n  } // escape `<>\"` before returns\n\n\n  value = escapeAttrValue(value);\n  return value;\n} // RegExp list\n\n\nvar REGEXP_LT = /</g;\nvar REGEXP_GT = />/g;\nvar REGEXP_QUOTE = /\"/g;\nvar REGEXP_QUOTE_2 = /&quot;/g;\nvar REGEXP_ATTR_VALUE_1 = /&#([a-zA-Z0-9]*);?/gim;\nvar REGEXP_ATTR_VALUE_COLON = /&colon;?/gim;\nvar REGEXP_ATTR_VALUE_NEWLINE = /&newline;?/gim;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_3 = /\\/\\*|\\*\\//gm;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_4 = /((j\\s*a\\s*v\\s*a|v\\s*b|l\\s*i\\s*v\\s*e)\\s*s\\s*c\\s*r\\s*i\\s*p\\s*t\\s*|m\\s*o\\s*c\\s*h\\s*a)\\:/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_5 = /^[\\s\"'`]*(d\\s*a\\s*t\\s*a\\s*)\\:/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_6 = /^[\\s\"'`]*(d\\s*a\\s*t\\s*a\\s*)\\:\\s*image\\//gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_7 = /e\\s*x\\s*p\\s*r\\s*e\\s*s\\s*s\\s*i\\s*o\\s*n\\s*\\(.*/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_8 = /u\\s*r\\s*l\\s*\\(.*/gi;\n/**\n * escape double quote\n *\n * @param {String} str\n * @return {String} str\n */\n\nfunction escapeQuote(str) {\n  return str.replace(REGEXP_QUOTE, \"&quot;\");\n}\n/**\n * unescape double quote\n *\n * @param {String} str\n * @return {String} str\n */\n\n\nfunction unescapeQuote(str) {\n  return str.replace(REGEXP_QUOTE_2, '\"');\n}\n/**\n * escape html entities\n *\n * @param {String} str\n * @return {String}\n */\n\n\nfunction escapeHtmlEntities(str) {\n  return str.replace(REGEXP_ATTR_VALUE_1, function replaceUnicode(str, code) {\n    return code[0] === \"x\" || code[0] === \"X\" ? String.fromCharCode(parseInt(code.substr(1), 16)) : String.fromCharCode(parseInt(code, 10));\n  });\n}\n/**\n * escape html5 new danger entities\n *\n * @param {String} str\n * @return {String}\n */\n\n\nfunction escapeDangerHtml5Entities(str) {\n  return str.replace(REGEXP_ATTR_VALUE_COLON, \":\").replace(REGEXP_ATTR_VALUE_NEWLINE, \" \");\n}\n/**\n * clear nonprintable characters\n *\n * @param {String} str\n * @return {String}\n */\n\n\nfunction clearNonPrintableCharacter(str) {\n  var str2 = \"\";\n\n  for (var i = 0, len = str.length; i < len; i++) {\n    str2 += str.charCodeAt(i) < 32 ? \" \" : str.charAt(i);\n  }\n\n  return _.trim(str2);\n}\n/**\n * get friendly attribute value\n *\n * @param {String} str\n * @return {String}\n */\n\n\nfunction friendlyAttrValue(str) {\n  str = unescapeQuote(str);\n  str = escapeHtmlEntities(str);\n  str = escapeDangerHtml5Entities(str);\n  str = clearNonPrintableCharacter(str);\n  return str;\n}\n/**\n * unescape attribute value\n *\n * @param {String} str\n * @return {String}\n */\n\n\nfunction escapeAttrValue(str) {\n  str = escapeQuote(str);\n  str = escapeHtml(str);\n  return str;\n}\n/**\n * `onIgnoreTag` function for removing all the tags that are not in whitelist\n */\n\n\nfunction onIgnoreTagStripAll() {\n  return \"\";\n}\n/**\n * remove tag body\n * specify a `tags` list, if the tag is not in the `tags` list then process by the specify function (optional)\n *\n * @param {array} tags\n * @param {function} next\n */\n\n\nfunction StripTagBody(tags, next) {\n  if (typeof next !== \"function\") {\n    next = function () {};\n  }\n\n  var isRemoveAllTag = !Array.isArray(tags);\n\n  function isRemoveTag(tag) {\n    if (isRemoveAllTag) return true;\n    return _.indexOf(tags, tag) !== -1;\n  }\n\n  var removeList = [];\n  var posStart = false;\n  return {\n    onIgnoreTag: function (tag, html, options) {\n      if (isRemoveTag(tag)) {\n        if (options.isClosing) {\n          var ret = \"[/removed]\";\n          var end = options.position + ret.length;\n          removeList.push([posStart !== false ? posStart : options.position, end]);\n          posStart = false;\n          return ret;\n        } else {\n          if (!posStart) {\n            posStart = options.position;\n          }\n\n          return \"[removed]\";\n        }\n      } else {\n        return next(tag, html, options);\n      }\n    },\n    remove: function (html) {\n      var rethtml = \"\";\n      var lastPos = 0;\n\n      _.forEach(removeList, function (pos) {\n        rethtml += html.slice(lastPos, pos[0]);\n        lastPos = pos[1];\n      });\n\n      rethtml += html.slice(lastPos);\n      return rethtml;\n    }\n  };\n}\n/**\n * remove html comments\n *\n * @param {String} html\n * @return {String}\n */\n\n\nfunction stripCommentTag(html) {\n  var retHtml = \"\";\n  var lastPos = 0;\n\n  while (lastPos < html.length) {\n    var i = html.indexOf(\"<!--\", lastPos);\n\n    if (i === -1) {\n      retHtml += html.slice(lastPos);\n      break;\n    }\n\n    retHtml += html.slice(lastPos, i);\n    var j = html.indexOf(\"-->\", i);\n\n    if (j === -1) {\n      break;\n    }\n\n    lastPos = j + 3;\n  }\n\n  return retHtml;\n}\n/**\n * remove invisible characters\n *\n * @param {String} html\n * @return {String}\n */\n\n\nfunction stripBlankChar(html) {\n  var chars = html.split(\"\");\n  chars = chars.filter(function (char) {\n    var c = char.charCodeAt(0);\n    if (c === 127) return false;\n\n    if (c <= 31) {\n      if (c === 10 || c === 13) return true;\n      return false;\n    }\n\n    return true;\n  });\n  return chars.join(\"\");\n}\n\nexports.whiteList = getDefaultWhiteList();\nexports.getDefaultWhiteList = getDefaultWhiteList;\nexports.onTag = onTag;\nexports.onIgnoreTag = onIgnoreTag;\nexports.onTagAttr = onTagAttr;\nexports.onIgnoreTagAttr = onIgnoreTagAttr;\nexports.safeAttrValue = safeAttrValue;\nexports.escapeHtml = escapeHtml;\nexports.escapeQuote = escapeQuote;\nexports.unescapeQuote = unescapeQuote;\nexports.escapeHtmlEntities = escapeHtmlEntities;\nexports.escapeDangerHtml5Entities = escapeDangerHtml5Entities;\nexports.clearNonPrintableCharacter = clearNonPrintableCharacter;\nexports.friendlyAttrValue = friendlyAttrValue;\nexports.escapeAttrValue = escapeAttrValue;\nexports.onIgnoreTagStripAll = onIgnoreTagStripAll;\nexports.StripTagBody = StripTagBody;\nexports.stripCommentTag = stripCommentTag;\nexports.stripBlankChar = stripBlankChar;\nexports.cssFilter = defaultCSSFilter;\nexports.getDefaultCSSWhiteList = getDefaultCSSWhiteList;","map":{"version":3,"sources":["C:/Users/Sallam/Desktop/projects/next-step/server/node_modules/xss/lib/default.js"],"names":["FilterCSS","require","getDefaultCSSWhiteList","getDefaultWhiteList","_","a","abbr","address","area","article","aside","audio","b","bdi","bdo","big","blockquote","br","caption","center","cite","code","col","colgroup","dd","del","details","div","dl","dt","em","figcaption","figure","font","footer","h1","h2","h3","h4","h5","h6","header","hr","i","img","ins","li","mark","nav","ol","p","pre","s","section","small","span","sub","summary","sup","strong","strike","table","tbody","td","tfoot","th","thead","tr","tt","u","ul","video","defaultCSSFilter","onTag","tag","html","options","onIgnoreTag","onTagAttr","name","value","onIgnoreTagAttr","escapeHtml","replace","REGEXP_LT","REGEXP_GT","safeAttrValue","cssFilter","friendlyAttrValue","trim","substr","REGEXP_DEFAULT_ON_TAG_ATTR_4","lastIndex","test","REGEXP_DEFAULT_ON_TAG_ATTR_7","REGEXP_DEFAULT_ON_TAG_ATTR_8","process","escapeAttrValue","REGEXP_QUOTE","REGEXP_QUOTE_2","REGEXP_ATTR_VALUE_1","REGEXP_ATTR_VALUE_COLON","REGEXP_ATTR_VALUE_NEWLINE","REGEXP_DEFAULT_ON_TAG_ATTR_3","REGEXP_DEFAULT_ON_TAG_ATTR_5","REGEXP_DEFAULT_ON_TAG_ATTR_6","escapeQuote","str","unescapeQuote","escapeHtmlEntities","replaceUnicode","String","fromCharCode","parseInt","escapeDangerHtml5Entities","clearNonPrintableCharacter","str2","len","length","charCodeAt","charAt","onIgnoreTagStripAll","StripTagBody","tags","next","isRemoveAllTag","Array","isArray","isRemoveTag","indexOf","removeList","posStart","isClosing","ret","end","position","push","remove","rethtml","lastPos","forEach","pos","slice","stripCommentTag","retHtml","j","stripBlankChar","chars","split","filter","char","c","join","exports","whiteList"],"mappings":"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","sourcesContent":["/**\n * default settings\n *\n * @author Zongmin Lei<leizongmin@gmail.com>\n */\n\nvar FilterCSS = require(\"cssfilter\").FilterCSS;\nvar getDefaultCSSWhiteList = require(\"cssfilter\").getDefaultWhiteList;\nvar _ = require(\"./util\");\n\nfunction getDefaultWhiteList() {\n  return {\n    a: [\"target\", \"href\", \"title\"],\n    abbr: [\"title\"],\n    address: [],\n    area: [\"shape\", \"coords\", \"href\", \"alt\"],\n    article: [],\n    aside: [],\n    audio: [\n      \"autoplay\",\n      \"controls\",\n      \"crossorigin\",\n      \"loop\",\n      \"muted\",\n      \"preload\",\n      \"src\",\n    ],\n    b: [],\n    bdi: [\"dir\"],\n    bdo: [\"dir\"],\n    big: [],\n    blockquote: [\"cite\"],\n    br: [],\n    caption: [],\n    center: [],\n    cite: [],\n    code: [],\n    col: [\"align\", \"valign\", \"span\", \"width\"],\n    colgroup: [\"align\", \"valign\", \"span\", \"width\"],\n    dd: [],\n    del: [\"datetime\"],\n    details: [\"open\"],\n    div: [],\n    dl: [],\n    dt: [],\n    em: [],\n    figcaption: [],\n    figure: [],\n    font: [\"color\", \"size\", \"face\"],\n    footer: [],\n    h1: [],\n    h2: [],\n    h3: [],\n    h4: [],\n    h5: [],\n    h6: [],\n    header: [],\n    hr: [],\n    i: [],\n    img: [\"src\", \"alt\", \"title\", \"width\", \"height\"],\n    ins: [\"datetime\"],\n    li: [],\n    mark: [],\n    nav: [],\n    ol: [],\n    p: [],\n    pre: [],\n    s: [],\n    section: [],\n    small: [],\n    span: [],\n    sub: [],\n    summary: [],\n    sup: [],\n    strong: [],\n    strike: [],\n    table: [\"width\", \"border\", \"align\", \"valign\"],\n    tbody: [\"align\", \"valign\"],\n    td: [\"width\", \"rowspan\", \"colspan\", \"align\", \"valign\"],\n    tfoot: [\"align\", \"valign\"],\n    th: [\"width\", \"rowspan\", \"colspan\", \"align\", \"valign\"],\n    thead: [\"align\", \"valign\"],\n    tr: [\"rowspan\", \"align\", \"valign\"],\n    tt: [],\n    u: [],\n    ul: [],\n    video: [\n      \"autoplay\",\n      \"controls\",\n      \"crossorigin\",\n      \"loop\",\n      \"muted\",\n      \"playsinline\",\n      \"poster\",\n      \"preload\",\n      \"src\",\n      \"height\",\n      \"width\",\n    ],\n  };\n}\n\nvar defaultCSSFilter = new FilterCSS();\n\n/**\n * default onTag function\n *\n * @param {String} tag\n * @param {String} html\n * @param {Object} options\n * @return {String}\n */\nfunction onTag(tag, html, options) {\n  // do nothing\n}\n\n/**\n * default onIgnoreTag function\n *\n * @param {String} tag\n * @param {String} html\n * @param {Object} options\n * @return {String}\n */\nfunction onIgnoreTag(tag, html, options) {\n  // do nothing\n}\n\n/**\n * default onTagAttr function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @return {String}\n */\nfunction onTagAttr(tag, name, value) {\n  // do nothing\n}\n\n/**\n * default onIgnoreTagAttr function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @return {String}\n */\nfunction onIgnoreTagAttr(tag, name, value) {\n  // do nothing\n}\n\n/**\n * default escapeHtml function\n *\n * @param {String} html\n */\nfunction escapeHtml(html) {\n  return html.replace(REGEXP_LT, \"&lt;\").replace(REGEXP_GT, \"&gt;\");\n}\n\n/**\n * default safeAttrValue function\n *\n * @param {String} tag\n * @param {String} name\n * @param {String} value\n * @param {Object} cssFilter\n * @return {String}\n */\nfunction safeAttrValue(tag, name, value, cssFilter) {\n  // unescape attribute value firstly\n  value = friendlyAttrValue(value);\n\n  if (name === \"href\" || name === \"src\") {\n    // filter `href` and `src` attribute\n    // only allow the value that starts with `http://` | `https://` | `mailto:` | `/` | `#`\n    value = _.trim(value);\n    if (value === \"#\") return \"#\";\n    if (\n      !(\n        value.substr(0, 7) === \"http://\" ||\n        value.substr(0, 8) === \"https://\" ||\n        value.substr(0, 7) === \"mailto:\" ||\n        value.substr(0, 4) === \"tel:\" ||\n        value.substr(0, 11) === \"data:image/\" ||\n        value.substr(0, 6) === \"ftp://\" ||\n        value.substr(0, 2) === \"./\" ||\n        value.substr(0, 3) === \"../\" ||\n        value[0] === \"#\" ||\n        value[0] === \"/\"\n      )\n    ) {\n      return \"\";\n    }\n  } else if (name === \"background\") {\n    // filter `background` attribute (maybe no use)\n    // `javascript:`\n    REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {\n      return \"\";\n    }\n  } else if (name === \"style\") {\n    // `expression()`\n    REGEXP_DEFAULT_ON_TAG_ATTR_7.lastIndex = 0;\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_7.test(value)) {\n      return \"\";\n    }\n    // `url()`\n    REGEXP_DEFAULT_ON_TAG_ATTR_8.lastIndex = 0;\n    if (REGEXP_DEFAULT_ON_TAG_ATTR_8.test(value)) {\n      REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;\n      if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {\n        return \"\";\n      }\n    }\n    if (cssFilter !== false) {\n      cssFilter = cssFilter || defaultCSSFilter;\n      value = cssFilter.process(value);\n    }\n  }\n\n  // escape `<>\"` before returns\n  value = escapeAttrValue(value);\n  return value;\n}\n\n// RegExp list\nvar REGEXP_LT = /</g;\nvar REGEXP_GT = />/g;\nvar REGEXP_QUOTE = /\"/g;\nvar REGEXP_QUOTE_2 = /&quot;/g;\nvar REGEXP_ATTR_VALUE_1 = /&#([a-zA-Z0-9]*);?/gim;\nvar REGEXP_ATTR_VALUE_COLON = /&colon;?/gim;\nvar REGEXP_ATTR_VALUE_NEWLINE = /&newline;?/gim;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_3 = /\\/\\*|\\*\\//gm;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_4 =\n  /((j\\s*a\\s*v\\s*a|v\\s*b|l\\s*i\\s*v\\s*e)\\s*s\\s*c\\s*r\\s*i\\s*p\\s*t\\s*|m\\s*o\\s*c\\s*h\\s*a)\\:/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_5 = /^[\\s\"'`]*(d\\s*a\\s*t\\s*a\\s*)\\:/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_6 = /^[\\s\"'`]*(d\\s*a\\s*t\\s*a\\s*)\\:\\s*image\\//gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_7 =\n  /e\\s*x\\s*p\\s*r\\s*e\\s*s\\s*s\\s*i\\s*o\\s*n\\s*\\(.*/gi;\nvar REGEXP_DEFAULT_ON_TAG_ATTR_8 = /u\\s*r\\s*l\\s*\\(.*/gi;\n\n/**\n * escape double quote\n *\n * @param {String} str\n * @return {String} str\n */\nfunction escapeQuote(str) {\n  return str.replace(REGEXP_QUOTE, \"&quot;\");\n}\n\n/**\n * unescape double quote\n *\n * @param {String} str\n * @return {String} str\n */\nfunction unescapeQuote(str) {\n  return str.replace(REGEXP_QUOTE_2, '\"');\n}\n\n/**\n * escape html entities\n *\n * @param {String} str\n * @return {String}\n */\nfunction escapeHtmlEntities(str) {\n  return str.replace(REGEXP_ATTR_VALUE_1, function replaceUnicode(str, code) {\n    return code[0] === \"x\" || code[0] === \"X\"\n      ? String.fromCharCode(parseInt(code.substr(1), 16))\n      : String.fromCharCode(parseInt(code, 10));\n  });\n}\n\n/**\n * escape html5 new danger entities\n *\n * @param {String} str\n * @return {String}\n */\nfunction escapeDangerHtml5Entities(str) {\n  return str\n    .replace(REGEXP_ATTR_VALUE_COLON, \":\")\n    .replace(REGEXP_ATTR_VALUE_NEWLINE, \" \");\n}\n\n/**\n * clear nonprintable characters\n *\n * @param {String} str\n * @return {String}\n */\nfunction clearNonPrintableCharacter(str) {\n  var str2 = \"\";\n  for (var i = 0, len = str.length; i < len; i++) {\n    str2 += str.charCodeAt(i) < 32 ? \" \" : str.charAt(i);\n  }\n  return _.trim(str2);\n}\n\n/**\n * get friendly attribute value\n *\n * @param {String} str\n * @return {String}\n */\nfunction friendlyAttrValue(str) {\n  str = unescapeQuote(str);\n  str = escapeHtmlEntities(str);\n  str = escapeDangerHtml5Entities(str);\n  str = clearNonPrintableCharacter(str);\n  return str;\n}\n\n/**\n * unescape attribute value\n *\n * @param {String} str\n * @return {String}\n */\nfunction escapeAttrValue(str) {\n  str = escapeQuote(str);\n  str = escapeHtml(str);\n  return str;\n}\n\n/**\n * `onIgnoreTag` function for removing all the tags that are not in whitelist\n */\nfunction onIgnoreTagStripAll() {\n  return \"\";\n}\n\n/**\n * remove tag body\n * specify a `tags` list, if the tag is not in the `tags` list then process by the specify function (optional)\n *\n * @param {array} tags\n * @param {function} next\n */\nfunction StripTagBody(tags, next) {\n  if (typeof next !== \"function\") {\n    next = function () {};\n  }\n\n  var isRemoveAllTag = !Array.isArray(tags);\n  function isRemoveTag(tag) {\n    if (isRemoveAllTag) return true;\n    return _.indexOf(tags, tag) !== -1;\n  }\n\n  var removeList = [];\n  var posStart = false;\n\n  return {\n    onIgnoreTag: function (tag, html, options) {\n      if (isRemoveTag(tag)) {\n        if (options.isClosing) {\n          var ret = \"[/removed]\";\n          var end = options.position + ret.length;\n          removeList.push([\n            posStart !== false ? posStart : options.position,\n            end,\n          ]);\n          posStart = false;\n          return ret;\n        } else {\n          if (!posStart) {\n            posStart = options.position;\n          }\n          return \"[removed]\";\n        }\n      } else {\n        return next(tag, html, options);\n      }\n    },\n    remove: function (html) {\n      var rethtml = \"\";\n      var lastPos = 0;\n      _.forEach(removeList, function (pos) {\n        rethtml += html.slice(lastPos, pos[0]);\n        lastPos = pos[1];\n      });\n      rethtml += html.slice(lastPos);\n      return rethtml;\n    },\n  };\n}\n\n/**\n * remove html comments\n *\n * @param {String} html\n * @return {String}\n */\nfunction stripCommentTag(html) {\n  var retHtml = \"\";\n  var lastPos = 0;\n  while (lastPos < html.length) {\n    var i = html.indexOf(\"<!--\", lastPos);\n    if (i === -1) {\n      retHtml += html.slice(lastPos);\n      break;\n    }\n    retHtml += html.slice(lastPos, i);\n    var j = html.indexOf(\"-->\", i);\n    if (j === -1) {\n      break;\n    }\n    lastPos = j + 3;\n  }\n  return retHtml;\n}\n\n/**\n * remove invisible characters\n *\n * @param {String} html\n * @return {String}\n */\nfunction stripBlankChar(html) {\n  var chars = html.split(\"\");\n  chars = chars.filter(function (char) {\n    var c = char.charCodeAt(0);\n    if (c === 127) return false;\n    if (c <= 31) {\n      if (c === 10 || c === 13) return true;\n      return false;\n    }\n    return true;\n  });\n  return chars.join(\"\");\n}\n\nexports.whiteList = getDefaultWhiteList();\nexports.getDefaultWhiteList = getDefaultWhiteList;\nexports.onTag = onTag;\nexports.onIgnoreTag = onIgnoreTag;\nexports.onTagAttr = onTagAttr;\nexports.onIgnoreTagAttr = onIgnoreTagAttr;\nexports.safeAttrValue = safeAttrValue;\nexports.escapeHtml = escapeHtml;\nexports.escapeQuote = escapeQuote;\nexports.unescapeQuote = unescapeQuote;\nexports.escapeHtmlEntities = escapeHtmlEntities;\nexports.escapeDangerHtml5Entities = escapeDangerHtml5Entities;\nexports.clearNonPrintableCharacter = clearNonPrintableCharacter;\nexports.friendlyAttrValue = friendlyAttrValue;\nexports.escapeAttrValue = escapeAttrValue;\nexports.onIgnoreTagStripAll = onIgnoreTagStripAll;\nexports.StripTagBody = StripTagBody;\nexports.stripCommentTag = stripCommentTag;\nexports.stripBlankChar = stripBlankChar;\nexports.cssFilter = defaultCSSFilter;\nexports.getDefaultCSSWhiteList = getDefaultCSSWhiteList;\n"]},"metadata":{},"sourceType":"script"}